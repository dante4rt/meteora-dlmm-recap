---
import { getTranslations, locales, type Locale } from '../i18n/utils';

interface Props {
  locale: Locale;
  currentPath: string;
}

const { locale, currentPath } = Astro.props;
const t = getTranslations(locale);

// Determine the alternate locale
const alternateLocale: Locale = locale === 'en' ? 'id' : 'en';

// Generate alternate path for new routing structure
// English: / (no prefix), Indonesian: /id/
function getAlternatePath(path: string, fromLocale: Locale, toLocale: Locale): string {
  // Remove leading/trailing slashes for easier processing
  const cleanPath = path.replace(/^\/+|\/+$/g, '');
  const segments = cleanPath.split('/').filter(Boolean);
  
  if (fromLocale === 'en' && toLocale === 'id') {
    // English â†’ Indonesian: add /id/ prefix
    return '/id' + (cleanPath ? '/' + cleanPath : '') + (path.endsWith('/') ? '/' : '');
  } else if (fromLocale === 'id' && toLocale === 'en') {
    // Indonesian â†’ English: remove /id/ prefix
    if (segments[0] === 'id') {
      segments.shift(); // Remove 'id' from the beginning
      return '/' + (segments.length ? segments.join('/') : '') + (path.endsWith('/') && segments.length ? '/' : '');
    }
  }
  
  // Fallback: return as-is
  return path;
}

const alternatePath = getAlternatePath(currentPath, locale, alternateLocale);

// Language display info
const languageInfo = {
  en: { code: 'EN', flag: 'ðŸ‡¬ðŸ‡§', label: t.language.en },
  id: { code: 'ID', flag: 'ðŸ‡®ðŸ‡©', label: t.language.id },
};

const targetLang = languageInfo[alternateLocale];
const ariaLabel = `${t.language.switchTo} ${targetLang.label}`;
---

<a 
  href={alternatePath} 
  class="language-switcher" 
  aria-label={ariaLabel}
  title={ariaLabel}
>
  <span class="language-flag" aria-hidden="true">{targetLang.flag}</span>
  <span class="language-code">{targetLang.code}</span>
</a>
